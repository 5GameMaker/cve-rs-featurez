#![deny(unsafe_code)]
#![deny(clippy::pedantic)]
#![deny(clippy::nursery)]

mod segfault;
mod use_after_free;

fn main() {
	let mut args = std::env::args();
	let _program = args.next();
	let Some(subcommand) = args.next() else {
		println!("{HELP}");
		return;
	};

	match subcommand.as_str() {
		"uaf" => use_after_free::use_after_free(),
		"segfault" => segfault::segfault(),
		"help" | "h" | "?" | "--help" | "-h" => println!("{HELP}"),
		other => println!("Error: Unknown command `{other}`.\n{HELP}"),
	}
}

const HELP: &str = r"
cve-rs: Blazingly fast CVEs, written in 100% safe rust.

This program exploits a soundness hole in lifetimes that lets us cast any lifetime to 'static, allowing us to create dangling references.
See: https://github.com/rust-lang/rust/issues/25860

Commands:
    help        Show this help message.
    uaf         Run the use-after-free CVE.
    segfault    Run the segfault CVE.
";
